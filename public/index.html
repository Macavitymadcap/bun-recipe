<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dan &amp; Stella's Recipes</title>
    <link rel="stylesheet" href="static/styles/index.css" />

    <script src="//unpkg.com/alpinejs" defer></script>

    <script
      src="https://unpkg.com/htmx.org@2.0.4"
      integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+"
      crossorigin="anonymous"
    ></script>

    <script src="static/scripts/index.js" type="module"></script>

    <script type="module">
      import { convert } from './static/scripts/index.js';
      window.convert = convert;
    </script>
  </head>

  <body>
    <header id="header" class="container grid">
      <h1 class="col-10">Recipes</h1>
      <button class="btn btn-outline col-2 col-push-right" id="main-menu-button" popovertarget="main-menu">Menu</button>
      <menu 
        id="main-menu" 
        popover 
        x-data="{ 
          closeMenu() {
            htmx.find('#main-menu').togglePopover()
          } 
        }"
      >
        <li class="form-group">
          <label for="create-button">Create</label>
  
          <button
            class="btn btn-icon btn-outline-success"
            title="Create recipe"
            hx-get="/form/create"
            hx-target="#main-content"
            name="create-button"
            popovertarget="main-menu"
            hx-indicator="#loading"
          >
            <svg
              aria-hidden="true"
              viewBox="0 0 24 24"
              width="24"
              height="24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
          </button>
        </li>
  
        <li class="form-group">
          <label for="search-button">Search</label>
  
          <button
            class="btn btn-icon btn-outline-primary"
            title="Search recipes"
            hx-get="/form/search"
            hx-target="dialog"
            hx-indicator="#loading"
            hx-on:htmx:after-request="if (event.detail.successful) { htmx.addClass('dialog', 'card-outline-primary'); htmx.find('dialog').showModal(); }"
          >
            <svg
              aria-hidden="true"
              viewBox="0 0 24 24"
              width="24"
              height="24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="11" cy="11" r="7"></circle>
              <line x1="16" y1="16" x2="20" y2="20"></line>
            </svg>
          </button>
        </li>
  
        <li class="form-group">
          <label for="refresh-button">Refresh</label>
  
          <button
            class="btn btn-icon btn-outline-warning"
            title="Refresh content"
            name="refesh-button"
            hx-get="/data/default"
            hx-target="#main-content"
            hx-swap="innerHTML"
            popovertarget="main-menu"
            hx-indicator="#refreshing"
          >
            <svg
              aria-hidden="true"
              viewBox="0 0 24 24"
              width="24"
              height="24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M23 4v6h-6"></path>
              <path d="M1 20v-6h6"></path>
              <path d="M3.51 9a9 9 0 0 1 14.13-3.36L23 10"></path>
              <path d="M20.49 15a9 9 0 0 1-14.13 3.36L1 14"></path>
            </svg>
          </button>
        </li>
  
        <li class="form-group">
          <label for="convert-popover-button">Convert</label>
          <button
           class="btn btn-icon btn-outline-secondary"
           title="Convert units"
           popovertarget="conversion-popover"
           x-on:click="closeMenu()"
          >
            <svg
              aria-hidden="true"
              viewBox="0 0 24 24"
              width="24"
              height="24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <rect x="2" y="3" width="8" height="6" rx="1"></rect>
              <rect x="14" y="15" width="8" height="6" rx="1"></rect>
              <path d="m10 6 4 4-4 4"></path>
              <line x1="10" y1="10" x2="14" y2="10"></line>
            </svg>
          </button>
        </li>
  
        <li class="form-group">
          <label for="download-link">Download</label>
          <a
            href="/data"
            download="recipes.json"
            class="btn btn-icon btn-outline-primary"
            name="download-link"
            x-on:click="closeMenu()"
          >
            <svg
              aria-hidden="true"
              viewBox="0 0 24 24"
              width="24"
              height="24"
              fill="none"
              stroke="currentColor"
              strokeWidth="2"
              strokeLinecap="round"
              strokeLinejoin="round"
            >
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7,10 12,15 17,10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
          </a>
        </li>
  
        <li class="form-group">
          <label for="upload-button">Upload</label>
          <button
            class="btn btn-icon btn-outline-secondary"
            title="Upload recipes from JSON"
            hx-get="/form/upload"
            hx-target="dialog"
            hx-indicator="#loading"
            hx-on:htmx:after-request="if (event.detail.successful) { htmx.addClass('dialog', 'card-outline-secondary'); htmx.find('dialog').showModal(); }"
            name="upload-button"
          >
            <svg
              aria-hidden="true"
              viewBox="0 0 24 24"
              width="24"
              height="24"
              fill="none"
              stroke="currentColor"
              strokeWidth="2"
              strokeLinecap="round"
              strokeLinejoin="round"
            >
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17,8 12,3 7,8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
          </button>
        </li>
      </menu>
    </header>


    <main class="container">
      <div
        id="main-content"
        hx-get="/data/default"
        hx-trigger="load once"
      ></div>
    </main>

    <dialog class="card"></dialog>

    <aside id="alerts" class="container">
      <div id="loading" class="alert alert-primary htmx-indicator">
        <strong>Loading content...</strong>
      </div>

      <div id="updating" class="alert alert-secondary htmx-indicator">
        <strong>Updating recipe ...</strong>
      </div>

      <div id="creating" class="alert alert-success htmx-indicator">
        <strong>Creating recipe ...</strong>
      </div>

      <div id="deleting" class="alert alert-danger htmx-indicator">
        <strong>Deleting recipe ...</strong>
      </div>

      <div id="refreshing" class="alert alert-warning htmx-indicator">
        <strong>Refreshing content...</strong>
      </div>
    </aside>

    <footer class="container">
      <p>&copy; 2025 Dan Kiernan</p>
    </footer>

    <article 
      id="conversion-popover" 
      class="card" 
      popover="manual"
      x-data="{
        fromUnit: 'lb', 
        toUnit: 'kg', 
        result: undefined, 
        value: undefined,
        convertUnits() { this.result = convert(this.value, this.fromUnit, this.toUnit) }
      }"
    >
      <div class="grid">
        <h4 class="col-11">Convert Units</h4>
        <button 
          class="btn btn-icon btn-outline-danger col-1" 
          popovertarget="conversion-popover"
          title="Close conversion popover"
        >
          <svg
            aria-hidden="true"
            viewBox="0 0 24 24"
            width="24"
            height="24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
          >
            <path d="M6 18L18 6"></path>
            <path d="M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <div class="grid">
        <datalist id="imperial-unit-list">
          <option>oz</option>
          <option>lb</option>
          <option>gal</option>
          <option>fl oz</option>
          <option>pt</option>
          <option>f</option>
        </datalist>
        <div class="form-group col-4">
          <label for="from-unit" x-model="fromUnit">From</label>
          <input id="from-unit" name="from-unit" type="text" x-model="fromUnit" list="imperial-unit-list" />
        </div>
        
        <datalist id="metric-unit-list">
          <option>g</option>
          <option>kg</option>
          <option>ml</option>
          <option>l</option>
          <option>c</option>
          <option>c (fan)</option>
        </datalist>
        <div class="form-group col-4">
          <label for="to-unit" x-model="toUnit">To</label>
          <input id="to-unit" name="to-unit" type="text" x-model="toUnit" list="metric-unit-list" />
        </div>

        <div class="form-group col-4">
          <label for="value">Value</label>
          <input id="value" name="value" type="number" x-model="value" />
        </div>

        <button 
          x-on:click="convertUnits" x-bind:disabled="!fromUnit || !toUnit || !value" 
          class="btn btn-outline-secondary col-6"
        >
          Convert
        </button>
        <div class="col-6">
          <b>Result:</b> <output x-text="result"></output>
        </div>
      </div>
    </article>
  </body>
</html>

